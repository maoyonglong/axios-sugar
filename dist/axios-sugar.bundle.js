var AxiosSugar=function(e){"use strict";function s(e){return void 0!==e}var n=function(e){this.isResend=!1,this.resendDelay=1e3,this.resendTimes=3,this.isSave=!1,this.prop="custom",e=e||{};for(var t=0,r=Object.keys(e);t<r.length;t++){var n=r[t];s(n)?this[n]=e[n]:console.error("[axios sugar]: the option "+n+" is not valid.")}},r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var o={STRING:2,BOOLEAN:4,NUMBER:8},i=void 0!==window;if(!i)var a=require("buffer").Buffer;function u(t){return function(e){if(!i&&a.isBuffer(e))return e.length;switch(typeof e){case"string":return e.length*o.STRING;case"boolean":return o.BOOLEAN;case"number":return o.NUMBER;case"object":return Array.isArray(e)?e.map(u(t)).reduce(function(e,t){return e+t},0):function(e,t){if(null==t)return 0;var r=0;for(var n in t){if("object"==typeof t[n]&&null!==t[n]){if(e.has(t[n]))continue;e.add(t[n])}r+=u(e)(n);try{r+=u(e)(t[n])}catch(e){e instanceof RangeError&&(r=0)}}return r}(t,e);default:return 0}}}function f(e){return u(new WeakSet)(e)}var c=(t.prototype.set=function(e,t){this.data[e]=t},t.prototype.get=function(e){return this.data[e]||null},t.prototype.contains=function(e){return void 0!==this.data[e]},t);function t(){this.data={}}var p,d,l,h=(r(d=g,l=p=c),d.prototype=null===l?Object.create(l):(v.prototype=l.prototype,new v),g.prototype.set=function(e,t){for(var r,n,o=this.data,s=0,i=Object.entries(o);s<i.length;s++){var a=i[s],u=a[0],c=a[1];r=(new Date).getTime(),n=c.time,r-n>=this.duration&&delete o[u]}f(t)+f(o)>this.limit&&(o=this.data={}),o[e]={data:t,time:(new Date).getTime()}},g.prototype.get=function(e){var t=this.data[e];return t?t.data:null},g);function v(){this.constructor=d}function g(e,t){var r=p.call(this)||this;return r.duration=3e5,r.limit=15728640,s(e)&&(r.duration=e),s(t)&&(r.limit=t),r}var m=(y.prototype.set=function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error("[axios-sugar]: "+e.message)}},y.prototype.get=function(e){var t=localStorage.getItem(e);return null===t?null:JSON.parse(t)},y.prototype.contains=function(e){return null!==this.get(e)},y);function y(){}var S=(b.prototype.push=function(e){this.confs.push(e)},b.prototype.contains=function(e){return 0<=this.confs.indexOf(e)},b.prototype.remove=function(e){var t=this.confs;return t.splice(t.indexOf(e),1)},b.prototype.forEach=function(n){this.confs.forEach(function(e,t,r){n.call(e,e,t,r)})},b);function b(){this.confs=[]}function O(e){return 0<=["post","put","patch"].indexOf(e)?"data":"get"===e?"params":"both"}function R(e){var t,r=e.method,i=e.url;function n(e){var t="";if(/\?/.test(i)){var r=i.split("?");i=r[0],t+=r[1]}if(e)for(var n=0,o=Object.entries(e);n<o.length;n++){var s=o[n];""!==t&&(t+="&"),t+=s[0]+"="+s[1]}return t}function o(e){return s(e)?JSON.stringify(e):""}switch(O(r)){case"params":t=n(e.params);break;case"data":t=o(e.data);break;case"both":t=n(e.params)||o(e.params)}return"method="+r+"&url="+i+"&data="+t}function j(e,t){return void 0===e?t:e}function x(e,s){var i,t=e.axios,a=e.storage,u=e.config,c=e.lifecycle;t.interceptors.request.use(function(e){if(e=function(e,t){if(void 0===t&&(t="custom"),"data"===O(e.method)&&e.data){var r=e.data[t];r&&(e[t]=r,delete e.data[t])}return e}(e,u.prop),s.contains(e))return i={reason:"existed"},Promise.reject(i);var t=e[u.prop],r=u.isSave;if(t&&(r=j(t.isSave,r)),r){var n=a.get(R(e));if(n)return i={reason:"saved",data:n},Promise.reject(i)}var o=c.beforeRequest(e);return o.state?(s.push(e),Promise.resolve(e)):(i={reason:"beforeRequestBreak",message:o.message},Promise.reject(i))},function(e){Promise.reject(e)})}var w=(P.prototype.beforeRequest=function(e){return{state:!0,message:""}},P.prototype.beforeResponse=function(e){return{state:!0,message:""}},P);function P(){}var A=(N.prototype.init=function(){var e,u,c,f,a,p,d;x(this,this.stack),u=(e=this).stack,f=e.axios,a=e.storage,p=e.config,d=e.lifecycle,f.interceptors.response.use(function(e){var t=e.config,r=e.data,n=d.beforeResponse(e);if(!n.state)return c={reason:"beforeResponseBreack",message:n.message},Promise.reject(c);var o,s=t.custom;if(s&&(o=j(s.isSave,p.isSave)),o){var i=R(t);a.set(i,r)}return Promise.resolve(r)},function(e){var t=e.reason;if(t)return"saved"===t?Promise.resolve(e.data):Promise.reject(e);var r=e.config;if(r){u.remove(r);var n=r[p.prop],o=p.isResend,s=p.resendDelay,i=p.resendTimes,a=0;return n&&(o=j(n.isResend,o),s=j(n.resendDelay,s),i=j(n.resendTimes,i),a=j(n.curResendTimes,0)),o?a<i?new Promise(function(e){setTimeout(function(){return n||(r.custom={}),r.custom.curResendTimes=++a,"string"==typeof r.data&&(r.data=JSON.parse(r.data)),e(f.request(r))},s)}):(c={reason:"resendEnd",message:"Can't get a response."},Promise.reject(c)):Promise.reject(e)}})},N);function N(e,t){var r=this;void 0===t&&(t={}),this.stack=new S,this.config=new n,this.storage=new c,this.lifecycle=new w,this.axios=e,["config","storage","lifecycle"].forEach(function(e){t[e]&&(r[e]=t[e])}),this.init()}return e.AxiosSugarConfig=n,e.AxiosSugarInnerReleaseStorage=h,e.AxiosSugarInnerStorage=c,e.AxiosSugarLifeCycle=w,e.AxiosSugarLocalStorage=m,e.default=A,e}({});
