var AxiosSugar=function(e,a){"use strict";a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function t(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function c(n,r){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function s(e,t){var n;if(null!=e)if("object"!=typeof e&&(e=[e]),n=e,"[object Array]"===toString.call(n))for(var r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function o(e){return void 0!==e}function n(e){return"[axios-sugar]: "+e+"."}function l(e){console.warn(n(e))}function f(e){console.error(n(e))}function u(e){throw new Error(n(e))}function p(){return"development"===process.env.NODE_ENV}function h(e){return"function"==typeof e}function d(e){return"number"==typeof e}function g(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r={};function o(e,t){"object"==typeof r[t]&&"object"==typeof e?r[t]=n(r[t],e):r[t]="object"==typeof e?n({},e):e}for(var i=0,a=arguments.length;i<a;i++)s(e[i],o);return r}.apply(null,e)}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r={};function o(e,t){"object"==typeof r[t]&&"object"==typeof e?r[t]=n(r[t],e):r[t]=e}for(var i=0,a=arguments.length;i<a;i++)s(e[i],o);return r}.apply(null,e)}var v,y={STRING:2,BOOLEAN:4,NUMBER:8},m="undefined"!=typeof window;function b(t){return function(e){if(!m&&v.isBuffer(e))return e.length;switch(typeof e){case"string":return e.length*y.STRING;case"boolean":return y.BOOLEAN;case"number":return y.NUMBER;case"object":return Array.isArray(e)?e.map(b(t)).reduce(function(e,t){return e+t},0):function(e,t){if(null==t)return 0;var n=0;for(var r in t){if("object"==typeof t[r]&&null!==t[r]){if(e.has(t[r]))continue;e.add(t[r])}n+=b(e)(r);try{n+=b(e)(t[r])}catch(e){e instanceof RangeError&&(n=0)}}return n}(t,e);default:return 0}}}function T(e){return b(new WeakSet)(e)}m||(v=require("buffer").Buffer);var w={release:!1,duration:3e5,limit:15728640},x=(S.prototype.release=function(e,t){var n;this.config.release&&o(this.data[e])&&(this.config.duration?(n=this.data[e].time,(new Date).getTime()-n>=this.config.duration&&(this.data[e]=void 0)):o(t)&&T(this.data)+T(t)>this.config.limit&&h(this.full)&&this.full(e,t))},S.prototype.full=function(e,t){u("The capacity of the storage is full")},S.prototype.set=function(e,t){try{return this.release(e,t),this.data[e]=t,!0}catch(e){return p()&&f(e.message),!1}},S.prototype.get=function(e){return this.release(e),this.data[e]||null},S);function S(e){this.data={},this.config=e?i(w,e):w}var O=(E.prototype.set=function(e,t){try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){return p()&&f(e.message),!1}},E.prototype.get=function(e){var t=localStorage.getItem(e);return null===t?null:JSON.parse(t)},E);function E(){this.data={}}var j={repeat:{interval:2e3},onlineCheck:{enable:!1,reconnect:{enable:!0}},save:{enable:!1,storage:new x},retry:{enable:!1,auto:!0,count:3,delay:2e3}},P=(A.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},A.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},A.prototype.each=function(t){this.handlers.forEach(function(e){null!==e&&t(e)})},A);function A(){this.handlers=[]}var N={tags:[],cancels:[],configs:[]};function _(e){(N.configs[e]=null)!==N.tags[e]&&(N.tags[e]=null,N.cancels[e]=null)}var k,q={get:function(e){var t=e.sugar.save;if(t.enable){var n=t.storage,r=N.tags[e.index];if(null!==r)return n.get(r)}return null},set:function(e){var t=e.sugar.save;if(t.enable){var n=t.storage,r=N.tags[e.index];if(null!==r)return n.set(r,{response:e.response,time:(new Date).getTime()}),!0}return!1}},B=(t(D,k=Error),D);function D(e,t){var n=this.constructor,r=k.call(this,e.message)||this;return r.name=n.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(r,n),"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(r,n.prototype):r.__proto__=n.prototype,r.reason=e,r.axios=t.axios,r.index=t.index,r.sugar=t.sugar,r.count=t.count,r.sendingTime=t.sendingTime,r.completeTime=t.completeTime,r.isAxiosSugarError=!0,r}function C(e){return e?JSON.stringify(e):""}function R(e,t,n){return t-e<n}function F(e,t){return function(e){var t,n,r,o=e.url,i=e.method;switch(0<=["post","put","patch"].indexOf(i)?"data":"params"){case"params":t=e.params||{},"get"===i&&(t=g((r={},0<=(n=o).indexOf("?")&&n.trim().substring(n.indexOf()).split("&").forEach(function(e){var t=e.trim().split("=");1===t.length?r[t[0]]="":r[t[0]]=r[t[1]]}),r),t)),t=C(t);break;case"data":t=C(e.data)}return"method="+i+"&url="+o+"&data="+t}(e)}function I(t){var n=this,e=re.repeatTag(t.axios,t.sugar),r=N.tags.indexOf(e);0<=r&&N.configs[r].sendingTime&&!R(N.configs[r].sendingTime,(new Date).getTime(),t.sugar.repeat.interval)&&(_(r),r=-1);function o(){var e=n.events.repeated;h(e)&&e.call(n,t)}0<=r&&(N.configs[r]&&N.configs[r].completeTime?(o(),u("The current request is repeated.")):(N.cancels[r]("The previous request is repeated."),N.tags[r]=null,N.cancels[r]=null,o()));var i=a.CancelToken.source();return t.axios.cancelToken=i.token,N.cancels.push(i.cancel),N.tags.push(e)-1}var X,U=(t(G,X=Error),G);function G(e){var t=this.constructor,n=X.call(this,e.message)||this;return n.name=t.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(n,t),"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(n,t.prototype):n.__proto__=t.prototype,n.reason=e,n}function L(e){return o(e)?e instanceof Promise?"promise":e instanceof Error?o(e.reason)?"reasonError":"error":void 0:"undefined"}function M(e){switch(L(e)){case"undefined":return;case"error":return new U(e);default:return e}}var J=function(e){var t=M(e);return t instanceof Promise?t.then(M,M):t};var z=(H.prototype.setStatusHandler=function(e,t){return this.reservedCodes.indexOf(e)<0?(this.statusTable[e]=t,!0):(p()&&f("can't set the handler of http status code "+e+"."),!1)},H.prototype.dispatch=function(n,r,o){var e=r.toString().substr(0,1),t=o.response,i=!1,a=void 0,s=o.reason&&o.sugar.retry.enable?function(){return i?(p()&&l("retry has been already called"),!1):(i=!0,a=function(n){var r=this;if(d(n.count)?n.count+=1:n.count=1,d(n.sugar.retry.count)&&n.count<=n.sugar.retry.count){var e=r.events.retried;return e&&e.call(r,n),new Promise(function(e,t){setTimeout(function(){t(r.request(n))},n.sugar.retry.delay)})}var t=r.events.retryFailed;return h(t)&&t.call(r,n),new Error("[axios-sugar]: retryFiled.")}.call(n,o),!0)}:void 0;function u(e,t){return e.call(n,r,o,t,s)}return h(this["on"+e+"XXBefore"])?t=u(this["on"+e+"XXBefore"],t):h(this.onStatusBefore)&&(t=u(this.onStatusBefore,t)),h(this.statusTable[r])&&(t=u(this.statusTable[r],t)),h(this["on"+e+"XXAfter"])?t=u(this["on"+e+"XXAfter"],t):h(this.onStatusAfter)&&(t=u(this.onStatusAfter,t)),a||t},H);function H(){this.statusTable={400:this.onBadRequest,401:this.onUnauthorized,403:this.onForbidden,404:this.onNotFound,405:this.onMethodNotAllow,406:this.onNotAcceptable,407:this.onProxyAuthenticationRequired,408:this.onTimeout,409:this.onConflict,500:this.onInternalServerError,501:this.onNotImplemented,502:this.onBadGateway},this.reservedCodes=Object.keys(this.statusTable)}var V,W=(t(K,V=z),K);function K(){return null!==V&&V.apply(this,arguments)||this}function Q(e,t,n){n&&t.sugar.retry.auto&&(n()||l("retry has been already retried before"))}function Y(e,t){var n=g(e,t);return t.save&&t.save.storage?n.save.storage=t.save.storage:n.save.storage=e.save.storage,n}["BadRequest","Unauthorized","Forbidden","NotFound","MethodNotAllow","NotAcceptable","ProxyAuthenticationRequired","Conflict","InternalServerError","NotImplemented","BadGateway"].forEach(function(e){W.prototype["on"+e]=function(e,t,n,r){return p()&&f(t.reason.message),Q(0,t,r),t.reason}}),W.prototype.on=function(e,t){var n;this["on"+((n=e).substring(0,1).toUpperCase()+n.substring(1))]=t},W.prototype.onTimeout=function(e,r,t,o){return i=this,u=function(){var t,n=this;return c(this,function(e){return(t=r.sugar.onlineCheck).enable?navigator.onLine?(p()&&f("online but timeout"),h(this.events.onlineTimeout)&&this.events.onlineTimeout.call(this,r,o),Q(0,r,o)):(p()&&f("offline"),h(this.events.offline)&&this.events.offline.call(this,r),t.reconnect.enable&&window.addEventListener("online",function(){h(n.events.online)&&(n.events.online.call(n,r,o),Q(0,r,o))})):(p()&&f(r.reason.message),Q(0,r,o)),[2,r.reason]})},new(s=(s=a=void 0)||Promise)(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function r(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}o((u=u.apply(i,a||[])).next())});var i,a,s,u};var Z,$=new W,ee=(te.prototype.request=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r;r=(r="string"==typeof t[0]?((e=t[1]||{}).url=t[0],t[2]):(e=t[0]||{},t[1]))?Y(j,r):this.config;var o=[function(n){var e=n.sugar.save.enable?q.get(n):null;return n.sendingTime=(new Date).getTime(),null!==e?Promise.resolve({response:e.response,sugar:n.sugar,index:n.index,sendingTime:n.sendingTime,cacheTime:e.time,completeTime:(new Date).getTime()}):this.axios.request(n.axios).then(function(e){return n.completeTime=(new Date).getTime(),{response:e,sugar:n.sugar,index:n.index,sendingTime:n.sendingTime,completeTime:n.completeTime}},function(e){n.completeTime=(new Date).getTime();var t=new B(e,n);return Promise.reject(t)})}.bind(this),void 0],i=e,a=i.isAxiosSugarError?{axios:i.axios,sugar:i.sugar,count:(d(i.count),i.count)}:{axios:e,sugar:r,cancelDisabled:!1},s=Promise.resolve(a);for(this.interceptors.request.each(function(e){o.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.each(function(e){o.push(e.fulfilled,e.rejected)});o.length;)s=s.then(o.shift(),o.shift());return s},te.prototype.on=function(e,t){this.events[e]=t},te.prototype.off=function(e,t){return this.events[e]===t&&!(this.events[e]=void 0)},te);function te(e,t){var n;this.httpStatusProcessor=$,this.axios=a.create(e),this.config=t||Object.assign({},j),this.events={},this.interceptors={request:new P,response:new P},(n=this).interceptors.request.use(function(e){return N.configs.push(e),e.index=I.call(n,e),e},function(e){return Promise.reject(e)}),n.interceptors.response.use(function(e){var t;return!q.set(e)||h(t=n.events.stored)&&t.call(n,e),R(e.sendingTime,e.completeTime,e.sugar.repeat.interval)||_(e.index),n.httpStatusProcessor.dispatch(n,e.response.status.toString(),e)},function(e){var t=e;return e.reason&&!R(e.sendingTime,e.completeTime,e.sugar.repeat.interval)&&_(e.index),e.reason&&e.reason.response&&(t=n.httpStatusProcessor.dispatch(n,e.reason.response.status.toString(),e)),(t=J(t))instanceof Promise&&1<=e.count&&_(e.index),t instanceof Promise?t:Promise.reject(t||e)})}function ne(){var e=Z.call(this)||this;return e.repeatTag=F,e.defaults=j,e.axiosDefaults=a.defaults,e.axios=a,e}["delete","get","head","options"].forEach(function(r){ee.prototype[r]=function(e,t,n){return this.request(i(t||{},{method:r,url:e}),n)}}),["post","put","patch"].forEach(function(o){ee.prototype[o]=function(e,t,n,r){return this.request(i(n||{},{method:o,url:e,data:t}),r)}});var re=new(t(ne,Z=ee),ne.prototype.create=function(e,t){return t=t&&Y(j,t),new ee(e,t)},ne.prototype.isCancel=function(e){return!!e.reason&&a.isCancel(e.reason)},ne.prototype.getUri=function(e){return a.getUri(e)},ne.prototype.spread=function(e){return a.spread(e)},ne.prototype.all=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.all(e)},ne.prototype.cancelAll=function(){var t=[];N.configs.map(function(e){null!==e&&t.push({cancel:N.cancels[e.index],config:e})}),h(this.cancelFilter)&&(t=this.cancelFilter(t)),t.forEach(function(e){e.cancel()})},ne.prototype.cancelFilter=function(e){return e.filter(function(e){return!e.config.cancelDisabled})},ne.prototype.cancelAutoRetry=function(e){e.sugar.retry.auto=!1},ne),oe={inner:x,local:O};return e.AxiosSugar=ee,e.HttpStatusProcessor=W,e.default=re,e.storage=oe,e}({},axios);
