var AxiosSugar=function(e){"use strict";var s=function(e){this.isResend=!1,this.resendDelay=1e3,this.resendTimes=3,this.isSave=!1,this.prop="custom",e=e||{};for(var t=0,r=Object.keys(e);t<r.length;t++){var s=r[t];void 0!==s?this[s]=e[s]:console.error("[axios sugar]: the option "+s+" is not valid.")}},o=(t.prototype.set=function(e,t){this.data[e]=t},t.prototype.get=function(e){return this.data[e]||null},t.prototype.contains=function(e){return void 0!==this.data[e]},t);function t(){this.data={}}var r=(n.prototype.set=function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.error("[axios-sugar]: "+e.message)}},n.prototype.get=function(e){var t=localStorage.getItem(e);return null===t?null:JSON.parse(t)},n.prototype.contains=function(e){return null!==this.get(e)},n);function n(){}var i=(a.prototype.push=function(e){this.confs.push(e)},a.prototype.contains=function(e){return 0<=this.confs.indexOf(e)},a.prototype.remove=function(e){var t=this.confs;return t.splice(t.indexOf(e),1)},a.prototype.forEach=function(s){this.confs.forEach(function(e,t,r){s.call(e,e,t,r)})},a);function a(){this.confs=[]}function h(e){var t,r=e.method,s=e.url;switch(r){case"get":if(t="",/\?/.test(s)){var o=s.split("?");s=o[0],t+=o[1]}if(e.params)for(var n=0,i=Object.entries(e.params);n<i.length;n++){var a=i[n];""!==t&&(t+="&"),t+=a[0]+"="+a[1]}break;case"post":t=JSON.stringify(e.data)}return"method="+r+"&url="+s+"&data="+t}function d(e,t){return void 0===e?t:e}var c=(u.prototype.beforeRequest=function(e){return{state:!0,message:""}},u.prototype.beforeResponse=function(e){return{state:!0,message:""}},u);function u(){}var f=(p.prototype.init=function(){var e,n,i,t,a,c,u,r,f,p,v,g,m,l;n=(e=this).stack,t=e.axios,a=e.storage,c=e.config,u=e.lifecycle,t.interceptors.request.use(function(e){if(n.contains(e))return i={reason:"existed"},Promise.reject(i);var t=e[c.prop],r=c.isSave;if(t&&(r=d(t.isSave,r)),r){var s=a.get(h(e));if(s)return i={reason:"saved",data:s},Promise.reject(i)}var o=u.beforeRequest(e);return o.state?(n.push(e),Promise.resolve(e)):(i={reason:"beforeRequestBreak",message:o.message},Promise.reject(i))},function(e){Promise.reject(e)}),f=(r=this).stack,v=r.axios,g=r.storage,m=r.config,l=r.lifecycle,v.interceptors.response.use(function(e){var t=e.config,r=e.data,s=l.beforeResponse(e);if(!s.state)return p={reason:"beforeResponseBreack",message:s.message},Promise.reject(p);var o,n=t.custom;if(n&&(o=d(n.isSave,m.isSave)),o){var i=h(t);g.set(i,r)}return Promise.resolve(r)},function(e){var t=e.reason;if(t)switch(t){case"existed":return;case"saved":return Promise.resolve(e.data);case"beforeRequestBreak":case"beforeResponseBreak":return Promise.reject(e.message)}var r=e.config;if(r){f.remove(r);var s=r[m.prop],o=m.isResend,n=m.resendDelay,i=m.resendTimes,a=0;return s&&(o=d(s.isResend,o),n=d(s.resendDelay,n),i=d(s.resendTimes,i),a=d(s.curResendTimes,0)),o&&a<i?(setTimeout(function(){s||(r.custom={}),r.custom.curResendTimes=++a,v.request(r)},n),p={reason:"timeout",message:"current resend times is "+a+"."},Promise.reject(p)):Promise.reject(e)}return Promise.reject(e)})},p);function p(e,t){var r=this;void 0===t&&(t={}),this.stack=new i,this.config=new s,this.storage=new o,this.lifecycle=new c,this.axios=e,["config","storage","lifecycle"].forEach(function(e){t[e]&&(r[e]=t[e])}),this.init()}return e.AxiosSugarConfig=s,e.AxiosSugarInnerStorage=o,e.AxiosSugarLifeCycle=c,e.AxiosSugarLocalStorage=r,e.default=f,e}({});
